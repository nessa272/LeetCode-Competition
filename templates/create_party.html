{% extends "base.html" %}

{% block main_content %}


<h1>Join or Create Party</h1>
<h2>Join a party your friends are in!</h2>
<!-- FYI: ❮ and ❯ for html character codes &#10094; and &#10095; -->
<div class="party-slideshow">
  <button class="slide-btn prev-slide">&#10094;</button>
  
  <div class="slides-container">
    {% for party in mutual_parties[:5] %}
    <div class="slide">
      <div class="slide-name">{{ party.name }}</div>
      <a href="{{ url_for('view_party', cpid=party.cpid) }}" class="btn btn-sm">View Party</a>
    </div>
    {% endfor %}
  </div>

  <button class="slide-btn next-slide">&#10095;</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('.slides-container');
    const slides = Array.from(container.children);
    let index = 0;

    const showSlide = (i) => {
        const offset = i * 128; // slide width + gap
        container.scrollTo({ left: offset, behavior: 'smooth' });
    }

    document.querySelector('.next-slide').addEventListener('click', () => {
        index = (index + 1) % slides.length;
        showSlide(index);
    });

    document.querySelector('.prev-slide').addEventListener('click', () => {
        index = (index - 1 + slides.length) % slides.length;
        showSlide(index);
    });
    });
</script>

<h2>Create new party</h2>
<form method="POST" action="{{ url_for('create_party') }}">
    <fieldset>
        <legend>Party Details</legend>

        <label for="party_name">Party Name</label>
        <input type="text" id="party_name" name="party_name"><br>

        <label for="party_goal">Party Goal (number of problems)</label>
        <input type="number" id="party_goal" name="party_goal" required><br>

        <label for="party_start">Start Date</label>
        <input type="date" id="party_start" name="party_start" required><br>

        <label for="party_end">End Date</label>
        <input type="date" id="party_end" name="party_end" required><br>
    </fieldset>

    <fieldset>
        <legend>Invite Friends</legend>

        {% if connections %}
            {% for user in connections %}
                {% if user.in_party %}
                    <label style="color:gray;">
                        {{ user.lc_username }} (Already in this party)
                    </label><br>
                {% else %}
                    {# create a unique id for each checkbox #}
                    <input type="checkbox" 
                           id="invite_{{ user.pid }}" 
                           name="invitees" 
                           value="{{ user.pid }}">
                    <label for="invite_{{ user.pid }}">{{ user.lc_username }}</label><br>
                {% endif %}
            {% endfor %}
        {% else %}
            <p>You have no connections to invite.</p>
        {% endif %}
    </fieldset>

    <button type="submit" class="btn">Create Party & Invite</button>
</form>
{% endblock %}

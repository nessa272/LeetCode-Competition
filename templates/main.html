{% extends "base.html" %}

{% block main_content %}
<h1>Main</h1>
<div class="content-card welcome-card">
    <div class="welcome-text">
        <h2>Welcome, {{ username }}!</h2>
        <p>
            You've solved
            <strong>{{ problems_today }}</strong>
            LeetCode problem{{ '' if problems_today == 1 else 's' }}
            today.
        </p>
    </div>

    <div class="welcome-actions">
        <a href="https://leetcode.com/problemset/all/"
           target="_blank"
           class="btn btn-primary">
            Go solve problems
        </a>

        <form method="POST" action="{{ url_for('refresh_my_stats', next=url_for('index')) }}"
            onsubmit="this.querySelector('button').disabled = true;
                        this.querySelector('button').innerText = 'Refreshing‚Ä¶';
                        document.body.style.cursor='wait';">
            <button type="submit" class="btn">
                Refresh Leetcode Stats
            </button>
        </form>
    </div>
</div>
<br>

<h2 class="leaderboard-title">üèÜ Top LeetCoders üèÜ</h2>

<div class="content-card leaderboard-card">
    <table class="leaderboard-table">
        <thead>
            <tr>
                <th>Rank</th>
                <th>User</th>
                <th>Coins</th>
            </tr>
        </thead>

        <tbody>
            {% for user in leaderboard %}
            <tr>
                <td class="rank-col">
                    {% if loop.index == 1 %}
                        <span class="medal gold">ü•á</span>
                    {% elif loop.index == 2 %}
                        <span class="medal silver">ü•à</span>
                    {% elif loop.index == 3 %}
                        <span class="medal bronze">ü•â</span>
                    {% else %}
                        {{ loop.index }}
                    {% endif %}
                </td>

                <td class="user-col">
                    <div class="user-wrapper" tabindex="0">

                        <div class="user-cell">
                            <img src="{{ url_for('uploaded_file', filename=user.filename) if user.filename else url_for('static', filename='default_pfp.jpg') }}"
                                class="leaderboard-pfp"
                                alt="profile pic">

                            <div class="user-text">
                                <div class="leaderboard-username">
                                    {{ user.username }}
                                </div>
                                <div class="leetcode-username">
                                    leetcode/{{ user.lc_username }}
                                </div>
                            </div>
                        </div>

                        <!-- Popover -->
                        <div class="user-popover">
                            <a href="{{ url_for('profile', pid=user.pid) }}">
                                View LeetParty Profile
                            </a>

                            <a href="https://leetcode.com/u/{{ user.lc_username }}/"
                            target="_blank" rel="noopener">
                                View LeetCode Profile
                            </a>
                        </div>

                    </div>
                </td>
                <td class="coins-col">
                    {{ user.num_coins }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


{% endblock %}

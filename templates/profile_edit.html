{% extends "base.html" %}

{% block main_content %}
<h1> {{ profile.name }} ({{ profile.username }})</h1>

<div id="profile-columns">

    <!-- LEFT COLUMN -->
    <div class="left-col">
          <h2>Your Profile</h2>
        <img src="{{ url_for('uploaded_file', filename=profile.filename) if profile.filename else url_for('static', filename='default_pfp.jpg') }}" alt="Profile Picture">

        <!-- change profile picture -->
        <form method="post" action="{{url_for('upload_profile_pic', pid=profile.pid)}}" enctype="multipart/form-data">
            <p><label>Edit profile photo:</label></p>
            <p><input type="file" name="pic" accept="image/*" onchange="validateImage(this)"></p>
            <p><button type="submit" class="btn">Upload</button></p>
        </form>

        <!-- change information -->
        <form action="{{ url_for('edit_profile', pid = profile.pid) }}" method="POST">
                <label for="name">Name</label>
                <input type="text" id="name" name="name" value="{{ profile.name }}">
                <br>
                <label for="username">Username</label>
                <input type="text" id="username" name="username" value="{{ profile.username }}">
                <br>
                <label for="lc_username">LeetCode Username</label>
                <input type="text" id="lc_username" name="lc_username" value="{{ profile.lc_username }}">
                <br>
                <button type="submit" class="btn" name="action" value="cancel">Cancel</button>
                <button type="submit" class="btn" name="action" value="update">Update</button>

          </form>


        <ul class="profile-list">
            <li><strong>Latest Submission:</strong> {{ profile.latest_submission }}</li> 
            <li><strong>Current Streak:</strong> {{ profile.current_streak }}</li>
            <li><strong>Longest Streak:</strong> {{ profile.longest_streak }}</li>
            <li><strong>Total Problems:</strong> {{ profile.total_problems }}</li>
            <li><strong>Coins:</strong> {{ profile.num_coins }}</li>
            <li><strong>Personal Goal:</strong> {{ profile.personal_goal }}</li>
            <li><strong>Number of Friends:</strong> {{ friends | length }}</li>
        </ul>

     
    </div>

    <!-- RIGHT COLUMN -->
    <div class="right-col">
        <h2>Followers</h2>
        <ul>
            {% for follower in followers %}
                <li>
                    <div class="user-wrapper people-user-cell" tabindex="0">
                        <!-- Name triggers popover -->
                        <span>{{ follower.name }} ({{ follower.username }})</span>

                        <!-- Popover -->
                        <div class="user-popover">
                            <a href="{{ url_for('profile', pid=follower.pid) }}">
                                View LeetParty Profile
                            </a>
                            <a href="https://leetcode.com/u/{{ follower.lc_username }}/"
                            target="_blank" rel="noopener">
                                View LeetCode Profile
                            </a>
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="right-col">
        <h2>Following</h2>
        <ul>
            {% for followed_user in follows %}
                <li>
                    <div class="user-wrapper people-user-cell" tabindex="0">
                        <!-- Name triggers popover -->
                        <span>{{ followed_user.name }} ({{ followed_user.username }})</span>

                        <!-- Popover -->
                        <div class="user-popover">
                            <a href="{{ url_for('profile', pid=followed_user.pid) }}">
                                View LeetParty Profile
                            </a>
                            <a href="https://leetcode.com/u/{{ followed_user.lc_username }}/"
                            target="_blank" rel="noopener">
                                View LeetCode Profile
                            </a>
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>
</div>
<script>
  function validateImage(input) {
    const file = input.files && input.files[0];
    if (!file) return;

    // Block non-images immediately
    if (!file.type || !file.type.startsWith("image/")) {
      alert("Please upload an image file (png/jpg/gif/webp).");
      input.value = "";
    }
  }
</script>

{% endblock %}
{% extends "base.html" %}

{% block main_content %}
<h1> {{ profile.name }} ({{ profile.username }})</h1>

<div id="profile-columns">

    <!-- LEFT COLUMN -->
    <div class="left-col">
        <h2>Profile</h2>
        <img src="{{ profile.pfp_url or url_for('static', filename='default_pfp.jpg') }}" alt="Profile Picture">

        <ul class="profile-list">
            <li><strong>Name:</strong> {{ profile.name }}</li>
            <li><strong>Username:</strong> {{ profile.username }}</li>
            <li><strong>Leetcode Username:</strong> {{ profile.lc_username }}</li>
            <li><strong>Latest Submission:</strong> {{ profile.latest_submission }}</li> 
            <li><strong>Current Streak:</strong> {{ profile.current_streak }}</li>
            <li><strong>Longest Streak:</strong> {{ profile.longest_streak }}</li>
            <li><strong>Total Problems:</strong> {{ profile.total_problems }}</li>
            <li><strong>Coins:</strong> {{ profile.num_coins }}</li>
            <li><strong>Personal Goal:</strong> {{ profile.personal_goal }}</li>
        </ul>
        {% if loggedin %}
        <a class="btn" name="action" value="edit_profile" href="{{ url_for('edit_profile', pid=profile.pid) }}">
            Edit Profile
       </a> 

       <br><br>
        <form method="POST" action="{{ url_for('refresh_my_stats', next=url_for('profile', pid=profile.pid)) }}"
            onsubmit="this.querySelector('button').disabled = true;
                        this.querySelector('button').innerText = 'Refreshingâ€¦';
                        document.body.style.cursor='wait';">
            <button type="submit" class="btn">
                Refresh Leetcode Stats
            </button>
        </form>

        {% if profile.last_refreshed %}
            <p><em>Last refreshed: {{ profile.last_refreshed.strftime("%b %d, %Y %H:%M") }}</em></p>
        {% else %}
            <p><em>Stats never fetched before.</em></p>
        {% endif %}

        <a class="btn" href="{{ url_for('logout') }}">Log Out</a>
        {% endif %}
    </div>

    <!-- RIGHT COLUMN -->
    <div class="right-col">
        <h2>Followers</h2>
        <ul class="friend-list">
            {% for follower in followers %}
                <li>
                    <a href="{{ url_for('profile', pid=follower.pid) }}">
                         {{ follower.name }} ({{ follower.lc_username }})
                    </a>
               </li>
            {% endfor %}
        </ul>
    </div>
    <!-- RIGHT COLUMN -->
    <div class="right-col">
        <h2>Following</h2>
        <ul class="friend-list">
            {% for followed_user in follows %}
                <li>
                    <!-- Profile link -->
                    <a href="{{ url_for('profile', pid=followed_user.pid) }}">
                        {{ followed_user.name }} ({{ followed_user.lc_username }})
                    </a>

                    <!-- Unfollow button -->
                    {% if loggedin %}
                    <form action="{{ url_for('profile', pid=profile.pid) }}" 
                        method="POST" 
                        style="display:inline;">
                        <input type="hidden" name="unfollow_friend" value="{{ followed_user.pid }}">
                        <button type="submit" name="action" value="Unfollow">Unfollow</button>
                    </form>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}

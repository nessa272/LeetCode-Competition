{% extends "base.html" %}

{% block main_content %}
<h1>My Code Parties</h1>

<h2>Mutual Parties You’re Not In</h2>
<!-- FYI: ❮ and ❯ for html character codes &#10094; and &#10095; -->
<div class="party-slideshow">
  <button class="slide-btn prev-slide">&#10094;</button>
  
  <div class="slides-container">
    {% for party in mutual_parties[:5] %}
    <div class="slide">
      <div class="slide-name">{{ party.name }}</div>
      <a href="{{ url_for('view_party', cpid=party.cpid) }}" class="btn btn-sm">View Party</a>
    </div>
    {% endfor %}
  </div>

  <button class="slide-btn next-slide">&#10095;</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('.slides-container');
    const slides = Array.from(container.children);
    let index = 0;

    const showSlide = (i) => {
        const offset = i * 128; // slide width + gap
        container.scrollTo({ left: offset, behavior: 'smooth' });
    }

    document.querySelector('.next-slide').addEventListener('click', () => {
        index = (index + 1) % slides.length;
        showSlide(index);
    });

    document.querySelector('.prev-slide').addEventListener('click', () => {
        index = (index - 1 + slides.length) % slides.length;
        showSlide(index);
    });
    });
</script>


<!-- Current Parties (OPEN) -->
<div class="party-card content-card">
    <div class="card-header" onclick="toggleCard(this)">
        <h2 class="card-title">Current Parties</h2>
        <span class="arrow">▼</span>
    </div>
    <div class="card-body">
        {% if current_parties %}
            {% for party in current_parties %}
            <a href="{{ url_for('view_party', cpid=party.cpid) }}" class="party-row">
                <div class="party-left">{{ party.name }}</div>
                <div class="party-right">{{ party.days_until_end }} day{% if party.days_until_end != 1 %}s{% endif %} left</div>
                {% if party.word_rank %}
                <div class="party-rank">You are in {{ party.word_rank }} place</div>
                {% endif %}
            </a>
            {% endfor %}
        {% else %}
        <p>No current parties.</p>
        {% endif %}
    </div>
</div>

<!-- Upcoming Parties (OPEN) -->
<div class="party-card content-card">
    <div class="card-header" onclick="toggleCard(this)">
        <h2 class="card-title">Upcoming Parties</h2>
        <span class="arrow">▼</span>
    </div>
    <div class="card-body">
        {% if upcoming_parties %}
            {% for party in upcoming_parties %}
            <a href="{{ url_for('view_party', cpid=party.cpid) }}" class="party-row">
                <div class="party-left">{{ party.name }}</div>
                <div class="party-right">Starts in {{ party.days_until_start }} day{% if party.days_until_start != 1 %}s{% endif %}</div>
            </a>
            {% endfor %}
        {% else %}
        <p>No upcoming parties.</p>
        {% endif %}
    </div>
</div>

<!-- Completed Parties (dCLOSED bc we want user to open if they want) -->
<div class="party-card content-card">
    <div class="card-header" onclick="toggleCard(this)">
        <h2 class="card-title">Completed Parties</h2>
        <span class="arrow">▼</span>
    </div>
    <div class="card-body collapsed">
        {% if completed_parties %}
            {% for party in completed_parties %}
            <a href="{{ url_for('view_party', cpid=party.cpid) }}" class="party-row">
                <div class="party-left">{{ party.name }}</div>
                <div class="party-right">Ended {{ party.days_since_end }} day{% if party.days_since_end != 1 %}s{% endif %} ago</div>
                {% if party.word_rank %}
                <div class="party-rank">You were in {{ party.word_rank }} place</div>
                {% endif %}
            </a>
            {% endfor %}
        {% else %}
        <p>No completed parties.</p>
        {% endif %}
    </div>
</div>

<script>
function toggleCard(header) {
    const body = header.nextElementSibling;
    const arrow = header.querySelector('.arrow');

    if (body.classList.contains('collapsed')) {
        body.classList.remove('collapsed');
        arrow.style.transform = 'rotate(180deg)';
    } else {
        body.classList.add('collapsed');
        arrow.style.transform = 'rotate(0deg)';
    }
}
</script>

{% endblock %}
